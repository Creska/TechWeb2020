<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script src="script/editor.js"></script>
  <script src="animations.js"></script>
  <script src="script/editing.js"></script>
  <script src="script/cards.js"></script>
  <script src="test.js"></script>
  <script src="../player/test.js"></script> <!-- SOLO PER TEST -->

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  
  <link rel="stylesheet" href="cover.css">
  <link rel="stylesheet" href="editor.css">

  <title>Editor</title>

  <script>
    /* comunicazione con l'editor CSS */
    window.onload = function() {
      window.addEventListener( "message", (e) => {
        /*
        if ( CSS_Editor_Window == null || e.origin != CSS_Editor_Window.location.origin )
          return;*/

        switch ( e.data.event_type ) {
          case "ready":
            CSS_Editor_Window.postMessage( CSSdata.sheet, "*" );
            break;
          case "save":
            CSSdata = e.data.content;
            break;
        }
      });
    };

    /* abilita tutti i tooltips */
    $(document).ready( function() {
      $('[data-toggle="tooltip"]').tooltip({
        trigger : 'hover'
      });
      $('[data-toggle="tooltip"]').mouseout( function() {
        $('[data-toggle="tooltip"]').tooltip({
          trigger : 'hover'
        });
      });
    });

    /* modali per chiamate ajax */
    $(document).ajaxStart(function(){
      $('#wait_modal').modal('show');
      //$("#loading").css("display", "block");
    });

    $(document).ajaxSuccess(function(){
      //$('#wait_modal').modal('hide');
      $('#wait_modal').modal('hide');
      //$("#loading").css("display", "none");
      $('#success_modal').modal('show');
    });

    $(document).ajaxError(function(){
      $('#wait_modal').modal('hide');
      //$("#loading").css("display", "none");
      $('#fail_modal').modal('show');
    });
  </script>
</head>


<body class="text-center">

  <!-- MODALI PER CHIAMATE AJAX -->
  <div class="modal" style="background-color: transparent; border: none;" id="wait_modal" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" style="background-color: transparent; border: none;" role="document">
      <div class="modal-content" style="background-color: transparent; border: none;">    
        <img style="width: 75%;" src="loading.gif" />              
      </div>
    </div>
  </div>

  <div class="modal fade" id="success_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">      
        <img style="width: 100%;" src="https://media1.tenor.com/images/d8fb39693bab23e2c3b4ee36317a36ee/tenor.gif?itemid=17836773" />                
        <div style='color:black' class="modal-body" >
        é andato tutto bene!
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="fail_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">      
        <img style="width: 100%;" src="https://media1.tenor.com/images/87d588d92e1b4decd302a96c265d7a39/tenor.gif?itemid=18634343" />               
        <div style='color:black' class="modal-body" >
        Qualcosa è andato storto, che cosa?
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">
      
        <img style="width: 100%;" src="https://media.tenor.com/images/f6d1602a1c9e507b2cfe8e7c98faadd9/tenor.gif" />
                
      <div style='color:black' class="modal-body" >
        Attenzione! se torni nella home perderai tutto quello che non hai salvato, vuoi procedere lo stesso?
      </div>
      <div class="modal-footer">
        <button type="button" onclick="goToSection('MainMenu');" class="btn btn-primary" data-dismiss="modal">ok nigger</button>
      </div>
    </div>
  </div>
  </div>
  <div class="modal fade" id="publish_directly" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title">Attenzione</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>La storia è pubblicabile, vuoi pubblicarla già adesso o preferisci salvarla  sul server e basta?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="$('#publish_directly').modal('hide');saveStory(true) ">Pubblica</button>
          <button type="button" class="btn btn-primary" onclick="$('#publish_directly').modal('hide');saveStory(false)">Salva</button>
        </div>
      </div>
    </div>
  </div>
  <!-- BODY E SEZIONI EDITOR -->
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">

  <header class="masthead mb-auto">
    <div class="inner">
      <h3 class="masthead-brand">STORY EDITOR</h3>
      <nav class="nav nav-masthead justify-content-center">
        <a class="nav-link" href="javascript:start_saving();" data-toggle="tooltip" data-placement="bottom" title="Salva la storia su server">
          <i class="far fa-save fa-2x"></i>
        </a>
        <a class="nav-link" href="javascript:Navbar('CSSEditor');" data-toggle="tooltip" data-placement="bottom" title="Modifica il CSS">
          <i class="fab fa-css3 fa-2x"></i>
        </a>
        <a class="nav-link" href="javascript:Navbar('Preview');" data-toggle="tooltip" data-placement="bottom" title="Visualizza l'anteprima">
          <i class="far fa-eye fa-2x"></i>
        </a>
        <a class="nav-link" href="javascript:Navbar('Home');" data-toggle="tooltip" data-placement="bottom" title="Torna alla home">
          <i class="fas fa-home fa-2x"></i>
        </a>
      </nav>
    </div>
  </header>


  <!-- WIDGET PER IL PROMPT DEL SALVATAGGIO -->
  <div class="modal fade" id="SavePrompt" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title">Attenzione</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Salvare prima di tornare al menu principale?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="$('#SavePrompt').modal('hide'); goToSection('MainMenu');">Ignora</button>
          <button type="button" class="btn btn-primary" onclick="/* TODO */">Salva</button>
        </div>
      </div>
    </div>
  </div>


  <!-- MENU PRINCIPALE -->
  <main role="main" class="btn-group-vertical inner cover mx-auto EditorSection" id="MainMenu">
    <h1 class="cover-heading SectionTitle">Benvenuto nello Story Editor!</h1>
    <p class="lead mb-5 SectionHeader">Grazie a questo ambiente sarai in grado di creare una nuova storia, modificarne una già esistente, oppure gestire tutta la tua raccolta.</p>
    <div class="btn-group-vertical">
      <button class="btn btn-lg btn-secondary mb-3 rounded" onclick="MainMenu('NEWSTORY');" data-toggle="tooltip" data-placement="left" title="Crea una nuova storia"><i class="fas fa-plus"></i></button>
      <button class="btn btn-lg btn-secondary mb-3 rounded" onclick="MainMenu('CHOOSESTORY');" data-toggle="tooltip" data-placement="right" title="Modifica una storia già esistente"><i class="fas fa-edit"></i></button>
      <button class="btn btn-lg btn-secondary mb-3 rounded" onclick="MainMenu('EXPLORER');" data-toggle="tooltip" data-placement="left" title="Gestisci le storie salvate"><i class="fas fa-server"></i></button>
    </div>
  </main>


  <!-- GUIDA -->
  <main class="inner cover mx-auto EditorSection" id="Help">
    <h1 class="over-heading SectionTitle">Guida</h1>
    <p class="lead mb-5 SectionHeader">Una breve panoramica del funzionamento di questa applicazione.</p>

    <p class="text-justify">
      Grazie allo Story Editor potrai creare e modificare le storie e gestirne la pubblicazione.<br>
      Nei seguenti paragrafi potrai scoprire il funzionamento di ciascuna sezione di questa piattaforma.
    </p>

    <h2><strong>Le basi</strong></h2>

    <h3>Organizzazione del gioco</h3>
    <p class="text-justify">
      Ogni gioco interattivo, chiamato <strong>story</strong> (o <strong>storia</strong>), è composto da due tipologie di tappe: <strong>quest</strong> e <strong>attività</strong>.<br>
      Ciascuna <strong>quest</strong> è titolabile e rappresenta un numero arbitrario di <strong>attività</strong>, concatenate nell'ordine specificato dall'autore.
      Ogni <em>attività</em> può essere di due tipologie differenti, ovvero <strong>interattiva</strong> o di <strong>sola lettura</strong>, ed è composta da paragrafi di testo ed immagini. In ogni gioco è necessario l'inserimento di una <em>attività finale</em>, ovvero la particolare tappa a cui tutti i possibili percorsi devono convergere. Spetta a te fare in modo che il finale della narrazione porti in ogni caso ad essa.<br>
      Le <em>quest</em>, per convenzione, iniziano con l'<em>attività</em> numero 0 e proseguono secondo le direttive che darai nell'apposita sezione per la <strong>modifica degli outcomes</strong>. L'ordine con cui viene proseguita la <em>quest</em> dipende quindi dalle risposte che il giocatore inserirà quando richiesto, mentre il passaggio da una <em>quest</em> all'altra segue l'ordine con il quale esse sono state inserite all'interno della storia. La valutazione di ogni esercizio può essere eseguita automaticamente, seguendo quindi uno schema di risposte prestabilite dall'autore, oppure tramite l'invio di una richiesta di valutazione all'apposita applicazione.
    </p>

    <h3>Numero di giocatori</h3>
    <p class="text-justify">
      Ogni gioco può essere progettato per uno specifico numero di giocatori. Oltre alla modalità <em>single player</em> vi è anche quella di gruppo, che prevede un numero di giocatori tra 2 e 5. Queste due modalità sono identiche in tutto, a parte il fatto che la seconda permetta appunto di far funzionare il gioco su un numero di dispositivi maggiore di uno. C'è poi una terza modalità, quella per le classi. Questa modalità consente al server di dividere una classe di massimo 25 membri in più gruppi con lo stesso numero di persone (specificato dall'utente). I gruppi vengono creati in base al momento in cui gli studenti scannerizzano il QRcode. In questa particolare mode, tutte le quest, con l'esclusione della prima e dell'ultima, vengono posizionate in ordine random, in modo da evitare assembramenti di studenti in una particolare area. Spetta quindi all'utente creare una storia le cui fasi possano essere affrontate in ordini diversi.</span>
    </p>

    <h3>Accessibilità</h3>
    <p class="text-justify">
      Spuntando la relativa opzione, nel file di gioco vengono inseriti i dati che, automaticamente, permetteranno all'applicazione player di segnalare al giocatore che la partita è accessibile. L'unica ulteriore differenza con la modalità non accessibile è l'obbligo di inserimento delle descrizioni testuali per le immagini, che saranno quindi necessarie per pubblicare la storia in questione.<br>
      Per rendere la storia completamente e realmente accessibile a giocatori disabili è anche necessario progettare il tutto tenendo conto delle problematiche che affliggono gli studenti affetti da queste patologie:</p>
    <ul class="text-left">
      <li>Visive: disabilità visive tra cui cecità, ipovisione e problemi nella distinzione dei colori.</li>
      <li>Motorie: difficoltà o impossibilità di usare le mani, inclusi tremori, lentezza muscolare, non completa padronanza della mobilità fine, ecc.</li>
      <li>Uditive: sordità e/o disturbi dell'udito.</li>
      <li>Convulsioni: attacchi foto-epilettici causati da effetti stroboscopici e/o lampeggianti.</li>
      <li>Cognitive e intellettive: disabilità dello sviluppo, difficoltà di apprendimento (dislessia, discalculia, ecc.) E disabilità cognitive (sindrome di Down, Alzheimer) di varie origini, che causano effetti negativi su memoria, attenzione, sviluppo, capacità logiche e di problem solving, etc.</li>
    </ul>
    <p class="text-justify">
      L'applicazione è in grado di controllare solamente la presenza delle descrizioni per ogni immagine. Spetta quindi all'autore, nel caso abbia scelto l'opzione <em>Accessibile</em>, il compito di assicurarsi che la storia sia giocabile da tutti gli studenti.
    </p>
    
    <h3>Gestione delle fasi di gioco</h3>
    <p class="text-justify">
      Le liste di <em>quest</em>, <em>attività</em> e testi/immagini sono comodamente gestibili tramite un intuitivo sistema di cards. Potrai modificare il tuo lavoro in modo semplice e veloce anche grazie alle apposite modalità di <strong><em>swap</em></strong> e <strong><em>cancel</em></strong>. La prima ti permetterà di scambiare due cards, mentre la seconda di eliminare quella su cu hai cliccato due volte. Per attivare e disattivare ciascuna modalità ti basta cliccare sull'apposito pulsante.
    </p>

    <h2><strong>Gestione delle storie</strong></h2>
    <h3>Salvataggio</h3>
    <p class="text-justify">
      Per salvare e cancellare le storie sul server basterà utilizzare l'apposita sezione dell'editor, apribile direttamente dal Menu principale.
    </p>

    <h3>Pubblicazione</h3>
    <p class="text-justify">
      Per rendere accessibile una storia all'applicazione player, e quindi creare l'apposito QRcode, basterà utilizzare la sezione relativa alla pubblicazione dei giochi. In fase di pubblicazione, un'apposita procedura automatica controllerà i requisiti fondamentali perché l'operazione vada a buon fine, e segnala eventuali errori. Ritirare una storia significa renderla non più giocabile dall'applicazione player.
      In fase di pubblicazione di una storia verrà creato anche l'apposito QRcode.
    </p>

    <h2><strong>Modificare le storie</strong></h2>
    <p class="text-justify">
      Qui puoi trovare la spiegazione di tutte le sezioni dell'editor, ognuna delle quali ti offrirà una specifica serie di funzionalità per creare un gioco.
    </p>

    <h3>Storia</h3>
    <p class="text-justify">In questa sezione potrai gestire l'insieme delle <em>quest</em>, aggiungere il titolo della storia e accedere alla schermata per la modifica della <strong>modalità di gioco</strong></p>.

    <h3>Modalità di gioco</h3>
    <p class="text-justify">Questa schermata ti permette di specificare il numero di players per cui la storia è pensata e decidere se rendere il gioco totalmente accessibile per alcune categorie di utenti con disabilità.</p>

    <h3>Quest</h3>
    <p class="text-justify">In questa sezione potrai gestire l'insieme delle <em>attività</em> e modificare il titolo che vuoi dare alla <em>quest</em> selezionata.</p>

    <h3>Attività</h3>
    <p class="text-justify">
      In questa sezione puoi creare e modificare il testo dell'<em>attività</em>, aggiungendo paragrafi di testo e gallerie di una o più immagini. Questi elementi sono gestiti nello stesso modo che hai utilizzato per la lista di <em>quest</em> e <em>attività</em>. Da qui potrai inoltre accedere alle schermate relative al campo risposta e al sistema di <em>outcomes</em>. Non va trascurata la specificazione della tipologia: puoi scegliere tra <em>attività</em> interattiva, di sola lettura e <em>finale</em>. Quest'ultima funziona come una tappa di sola lettura, ma senza <em>outcomes</em>.
    </p>

    <h3>Campo risposta</h3>
    <p class="text-justify">
      Grazie a questa schermata potrai scegliere tra diverse tipologie di campo risposta: testo, numero, lista di opzioni, orario e data. Tra gli opportuni settings, hai la possibilità di inserire il testo della domanda e specificare se sono presenti risposte prestabilite (e quindi un relativo sistema di <em>outcomes</em>) o se l'applicazione <em>player</em> dovrà richiedere l'apposita valutazione da parte del valutatore. Puoi anche specificare se associare al campo risposta un timer relativo al tempo entro cui si prevede venga attribuita una risposta. Allo scadere del tempo, viene segnalato al valutatore un momento di difficoltà, in modo del tutto trasparente al giocatore.
    </p>

    <h3>Sistema di outcomes</h3>
    <p class="text-justify">
      Per <em>outcome</em> si intende una tripla [risposta - punteggio - prossima attività]. L'apposita sezione ti permette di specificare gli outcomes di ogni <em>attività</em> (esclusa ovviamente quella finale) e corrispondenti ad una risposta specifica o di default. Naturalmente vi sarà un unico outcome nelle <em>attività</em> di sola lettura.
    </p>

    <h3>Paragrafo di testo</h3>
    <p class="text-justify">
      Questa sezione ti permetterà semplicemente di inserire un nuovo paragrafo di testo all'interno della narrazione di una specifica <em>attività</em>.
    </p>

    <h3>Galleria di immagini</h3>
    <p class="text-justify">Grazie a questa schermata potrai creare e modificare una gallery costituita da una o più immagini. Per ogni immagine è presente un campo testo nel quale inserire l'apposita descrizione del file. Questa caratteristica è necessaria per creare una storia accessibile ed è ovviamente richiesta per permetterne la pubblicazione.</p>

    <h2><strong>Grafica</strong></h2>
    <p class="text-justify">
      Per la modifica del CSS è presente un apposito editor, con relativa guida. La personalizzazione della grafica non è fondamentale per la realizzazione della storia, ma è consigliata a tutti gli autori con esperirenza nella scrittura di stylesheet CSS.
    </p>
  </main>


  <!-- SCELTA DI MODALITA' DI GIOCO -->
  <main class="inner cover mx-auto EditorSection" id="ChooseGameMode">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Modalità di gioco</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Scegli il numero di giocatori e regola l'accessibilità.
    </p>

    <div>
      <p>Numero di giocatori:</p>
      <div class="card-deck">
        <div class="card rounded bg-secondary" id="gm0" onclick="select(0);">
          <img src="../images/single.jpg" class="card-img-top" alt="..." >
          <div class="card-body">
            <h5 class="card-title">Single Player</h5>
          </div>
        </div>
        <div class="card rounded bg-secondary" id="gm1" onclick="select(1);">
          <img src="../images/group.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">Gruppo</h5>
            <p class="card-text">Gruppo unico da 2-5 membri</p>
          </div>
        </div>
        <div class="card rounded bg-secondary" id="gm2" onclick="select(2);">
          <img src="../images/class.jpg" class="card-img-top" alt="...">
          <div class="card-body">
            <h5 class="card-title">Classe</h5>
            <p class="card-text">4-25 membri divisi equamente in gruppi che giocano in parallelo</p>
          </div>
        </div>
      </div>
    </div>
  
    <div class="mt-5" id="PlayersN">
      <p>Specifica il numero massimo di giocatori previsti per ogni gruppo:</p>
      <input type="number" placeholder="0" min="2" max="5">
    </div>
    
    <div class="mb-3">
      <p class="mt-5">Adesso scegli se rendere la storia accessibile (scelta consigliata) o meno:</p>
      <button id="gm3" class="btn btn-secondary btn-lg mr-3 rounded-circle bg-secondary" onclick="select(3);"><i class="fab fa-accessible-icon"></i></button>
      <button id="gm4" class="btn btn-secondary btn-lg rounded-circle bg-secondary" onclick="select(4);"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="p-3 Save-Cancel">
      <button class="btn btn-success mb-3 mr-2 ml-2 rounded" onclick="saveGameModeSettings();">Salva</button>
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick=back();>Annulla</button>
    </div>
  </main>


  <!-- GESTIONE DEL TITOLO DELLA STORIA E DELL'INSIEME DI QUEST -->
  <main role="main" class="inner cover EditorSection" id="EditStory">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Storia</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Qui puoi gestire le impostazioni generali del gioco e la lista di tutte le quest.
    </p>

    <div class="input-group font-weight-bold">
      <div class="input-group-prepend">
        <span class="input-group-text bg-light">Titolo:</span>
      </div>
      <input type="text" id="StoryTitleInput" class="form-control" placeholder="Nuova Storia" onclick="change_color_option('#SaveStoryTitle', 'btn-success', 'btn-primary'); $('#SaveStoryTitle').text('Salva');">
      <div class="input-group-append">
         <button class="btn btn-success" id="SaveStoryTitle" type="button" onclick="save_title('story')">Salvato!</button>
      </div>
    </div>

    <div id="s_buttons_div" class="mt-5 p-3">
      <button class="btn btn-lg btn-secondary mb-3 mr-5 rounded" onclick="goToSection('ChooseGameMode');" data-toggle="tooltip" data-placement="left" title="Cambia la modalità di gioco">
        <i class="fas fa-cog"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 rounded SwapBtn" onclick="swap_mode()" data-toggle="tooltip" data-placement="bottom" title="Swap mode">
        <i class="fas fa-people-carry"></i>
      </button>
      <button id="s_new_button" class="btn btn-lg btn-secondary mb-3 mr-2 ml-2 rounded" onclick='$("#NewQuestWidget").removeClass("invisible");' data-toggle="tooltip" data-placement="top" title="Crea una nuova quest" ><i class="fas fa-plus"></i> </button>
      <button class="btn btn-lg btn-secondary mb-3 rounded CancelBtn" onclick="cancel_mode()" data-toggle="tooltip" data-placement="right" title="Cancel mode">
        <i class="fas fa-trash"></i>
      </button>
    </div>

    <div id="NewQuestWidget" class="input-group input-group-sm mb-3 font-weight-bold invisible">
      <div class="input-group-prepend"> 
        <span class="input-group-text bg-light">Titolo:</span>
      </div>
      <input type="text" class="form-control col-sm-5 " placeholder="Titolo della quest">
        <div class="input-group-append">
          <button class="btn btn-sm btn-primary" type="button" onclick='create_stuff("quest");create_card( $("#NewQuestWidget input").val() );$("#NewQuestWidget").addClass("invisible");'>Aggiungi</button>

          <button class="btn btn-sm btn-danger" type="button" onclick="$('#NewQuestWidget input').val('');$('#NewQuestWidget').addClass('invisible');">Annulla</button>
        </div>
    </div>

    <div class="CardGrid" id="QuestsGrid" >
    </div>
  </main>


  <!-- SCHERMATA DI EDITING DELLA QUEST -->
  <main class="inner cover EditorSection" id="EditQuest">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Quest</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Qui puoi gestire le impostazioni della quest e la lista delle sue attività.
    </p>

    <div class="input-group mb-5 font-weight-bold">
      <div class="input-group-prepend">
        <span class="input-group-text bg-light">Titolo:</span>
      </div>
      <input type="text" id="QuestTitleInput" class="form-control" placeholder="Nuova Quest" onclick="change_color_option('#SaveQuestTitle', 'btn-success', 'btn-primary'); $('#SaveQuestTitle').text('Salva');">
      <div class="input-group-append">
         <button class="btn btn-primary" id="SaveQuestTitle" type="button" onclick="save_title('quest')">Salva</button>
      </div>
    </div>

    <div id="q_buttons_div" class="p-3">
      <button class="btn btn-lg btn-secondary mb-3 rounded SwapBtn" onclick="swap_mode()" data-toggle="tooltip" data-placement="left" title="Swap mode">
        <i class="fas fa-people-carry"></i>
      </button>
      <button id="q_new_button" class="btn btn-lg btn-secondary mb-3 mr-2 ml-2 rounded" onclick='create_stuff("activity");create_card("");' data-toggle="tooltip" data-placement="top" title="Crea una nuova attività">
        <i class="fas fa-plus"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 rounded CancelBtn" onclick="cancel_mode()" data-toggle="tooltip" data-placement="right" title="Cancel mode">
        <i class="fas fa-trash"></i>
      </button>
    </div>

    <div class="CardGrid" id="ActivitiesGrid">
    </div>

    <button type="button" class="btn bg-secondary rounded BackBtn" onclick="back()">
      <i class="fas fa-long-arrow-alt-left fa-2x mr-3 ml-3"></i>
    </button>
  </main>


  <!-- SCHERMATA DI EDITING DELLE ATTIVITA' -->
  <main class="inner cover EditorSection" id="EditActivity">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Attività</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      In questa sezione potrai creare e modificare il testo e la programmazione dell'attività.
    </p>

    <div class="p-3">
      <button class="btn btn-lg btn-secondary mb-3 rounded" onclick="openActivityTypeWidget();" data-toggle="tooltip" data-placement="left" title="Scegli la tipologia di attività">
        <i class="fas fa-cog"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 mr-2 ml-2 rounded" onclick="goToSection('EditAnswerField')" data-toggle="tooltip" data-placement="bottom" title="Modifica il campo di risposta">
        <i class="fas fa-tasks"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 rounded" onclick="goToSection('SetAnswerOutcome')" data-toggle="tooltip" data-placement="right" title="Modifica la progressione dell'attività">
        <i class="fas fa-route"></i>      
      </button>
    </div>

    <div id="ChooseActivityType">
      <div class="form-check">
        <input class="form-check-input" type="radio" name="ActivityType" id="ActivityType0">
        <label class="form-check-label" for="ActivityType0">
          Interattiva
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="ActivityType" id="ActivityType1">
        <label class="form-check-label" for="ActivityType1">
          Sola lettura
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="ActivityType" id="ActivityType2">
        <label class="form-check-label" for="ActivityType2">
          Finale (sola lettura)
        </label>
      </div>
      <button class="btn btn-primary mt-2" onclick="setActivityType();">Salva</button>
    </div>

    <div class="col-xs-12 alert alert-info text-justify" role="alert">
      <i class="fas fa-info"></i>
      <p>Marcando questa attività come finale, un'eventuale altra attività segnata come tale verrà riportata alla tipologia di sola lettura.</p>
    </div>

    <div id="q_buttons_div" class="p-3">
      <button class="btn btn-lg btn-secondary mb-3 rounded SwapBtn" onclick="swap_mode()" data-toggle="tooltip" data-placement="left" title="Swap mode">
        <i class="fas fa-people-carry"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 mr-2 ml-3 rounded" onclick='create_stuff("TextParagraph");create_card("[vuoto]");' data-toggle="tooltip" data-placement="top" title="Aggiungi paragrafo di testo">
        <i class="fas fa-paragraph"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 mr-3 rounded" onclick='create_stuff("Gallery");create_card("GALLERY");' data-toggle="tooltip" data-placement="top" title="Aggiungi galleria di immagini">
        <i class="far fa-images"></i>
      </button>
      <button class="btn btn-lg btn-secondary mb-3 rounded CancelBtn" onclick="cancel_mode()" data-toggle="tooltip" data-placement="right" title="Cancel mode">
        <i class="fas fa-trash"></i>
      </button>
    </div>

    <div class="CardGrid" id="ParagraphsGrid">
    </div>

    <button type="button" class="btn bg-secondary rounded BackBtn" onclick="back()">
      <i class="fas fa-long-arrow-alt-left fa-2x mr-3 ml-3"></i>
    </button>
  </main>


  <!-- SCHERMATA DI MODIFICA CAMPO RISPOSTA -->
  <main class="inner cover EditorSection" id="EditAnswerField">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Campo risposta</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Scegli tra cinque diversi tipi di esercizio e regolane gli aspetti fondamentali.
    </p>

    <div id="AFtype">
      <h4 class="mb-3">Tipologia di input</h4>
      <div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="QuestionType" id="QuestionType_Checklist">
          <label class="form-check-label" for="QuestionType_Checklist">Checklist</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="QuestionType" id="QuestionType_Text">
          <label class="form-check-label" for="QuestionType_Text">Testo</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="QuestionType" id="QuestionType_Number">
          <label class="form-check-label" for="QuestionType_Number">Numero</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="QuestionType" id="QuestionType_Date">
          <label class="form-check-label" for="QuestionType_Date">Data</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="QuestionType" id="QuestionType_Time">
          <label class="form-check-label" for="QuestionType_Time">Orario</label>
        </div>

        <div class="mt-5" id="ChecklistPreview">
          <h4 class="mb-3">Risposte selezionabili</h4>

          <ul class="mb-3"></ul>

          <div id="AddAnswerOption" class="input-group input-group-sm font-weight-bold">
            <div class="input-group-prepend">
              <span class="input-group-text bg-light">Aggiungi opzione:</span>
            </div>
            <input type="text" class="form-control col-sm-5" placeholder="Risposta">
            <div class="input-group-append">
              <button class="btn btn-sm btn-primary" type="button" onclick="addAnswerOption( $('#AddAnswerOption input').val().trim() );">Aggiungi</button>
              <button class="btn btn-sm btn-danger" type="button" onclick="$('#AddAnswerOption input').val('');">Annulla</button>
            </div>
          </div>
        </div>

        <script>
          $("#EditAnswerField input[name='QuestionType']").on("change", function() {
            if ( $("#QuestionType_Checklist").prop("checked") )
		          $( "#ChecklistPreview" ).fadeIn();
	          else
		          $( "#ChecklistPreview" ).fadeOut();
          });
        </script>
      </div>
    </div>
    
    <div class="w-100 mt-5" id="AnswerFieldSettings">
      <h4 class="mb-3">Opzioni del campo risposta</h4>
      <div class="row w-100">
        <div class="col-11">
          <div class="input-group m-1">
            <div class="input-group-prepend">
              <div class="input-group-text">Richiesta</div>
            </div>
            <input type="text" class="form-control" id="InsertAnswerFieldDescription" id="AnswerScore" placeholder="Testo della richiesta">
          </div>
       </div>

        <div class="col-1">
          <span class="badge badge-pill badge-light" data-toggle="tooltip" data-placement="left" title="Richiesta a cui il giocatore dovrà rispondere">
            <i class="fas fa-info"></i>
          </span>
        </div>
      </div>

      <div class="row w-100">
        <div class="col-11">
          <div class="input-group m-1">
            <div class="input-group-prepend">
              <span class="input-group-text">Valutazione live</span>
            </div>
            <div class="input-group-append">
              <div class="input-group-text">
                <input type="checkbox" id="NeedEvaluation">
              </div>
            </div>
          </div>
        </div>

        <div class="col-1">
          <span class="badge badge-pill badge-light" data-toggle="tooltip" data-placement="left" title="Se spuntata, indica che la valutazione verrà chiesta automaticamente al valutatore, al momento dell'invio della risposta">
            <i class="fas fa-info"></i>
          </span>
        </div>
      </div>
      
      <div class="row w-100">
        <div class="col-11">
          <div class="input-group m-1">
            <div class="input-group-prepend">
              <span class="input-group-text">Attivazione help timer</span>
            </div>
            <div class="input-group-append">
              <div class="input-group-text">
                <input type="checkbox" id="InsertTimer">
              </div>
            </div>
          </div>
        </div>

        <div class="col-1">
          <span class="badge badge-pill badge-light" data-toggle="tooltip" data-placement="left" title="Attiva il timer alla cui scadenza viene segnalato al valutatore che il player ha superato il tempo previsto per l'attività in esecuzione">
            <i class="fas fa-info"></i>
          </span>
        </div>
      </div>

      <div class="row w-100">
        <div class="col-11">
          <div class="input-group m-1">
            <div class="input-group-prepend">
              <span class="input-group-text">Tempo previsto (min)</span>
            </div>
            <input type="number" class="form-control" id="AnswerTimer" placeholder="1" min="1">
          </div>
        </div>
      
        <div class="col-1">
          <span class="badge badge-pill badge-light" data-toggle="tooltip" data-placement="left" title="Valore dell'help timer">
            <i class="fas fa-info"></i>
          </span>
        </div>
      </div>
          

      <script>
        $( "#InsertTimer" ).on( "click",  function() {
          if ( this.checked )
            $( "#AnswerTimer" ).attr( "disabled", false );
          else
            $( "#AnswerTimer" ).attr( "disabled", true );
        });
      </script>
    </div>
  
    <div class="p-3 Save-Cancel">
      <button class="btn btn-success mb-3 mr-2 ml-2 rounded" onclick="saveAnswerFieldSettings();">Salva</button>
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick="back();">Annulla</button>
    </div>
  </main>


  <!-- SCHERMATA PER LA MODIFICA DELLA PROGRESSIONE DELL'ATTIVITA' -->
  <main class="inner cover EditorSection" id="SetAnswerOutcome">
    <script>
      // attiva/disattiva i number input in base alla spunta sulla checkbox di passaggio alla quest successiva
      $(document).on( "click", ".OutcomesTable input[type='checkbox']", function() {
        if ( $(this).prop("checked") )
          $($(this).parent().next().children().first()).attr("disabled", true);
        else
          $($(this).parent().next().children().first()).attr("disabled", false);
      });
    </script>
    
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Sistema di outcomes</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Qui potrai regolare tutti gli outcomes dell'attività selezionata.
    </p>

    <div class="mt-5" id="ReadingActivity">
      <h4 class="mb-3">Programmazione attività</h4>
      <table class="w-100 mt-3 OutcomesTable">
        <tr class="mb-2">
      		<th>Risposta</th>
      		<th>Passa alla quest successiva</th>
      		<th>Passa ad attività specifica</th>
        </tr>
        <tr>
          <td><em>Sola lettura</em></td>
          <td><input type="checkbox"></td>
          <td><input type="number" placeholder="0" size="6" min="0"></td>
        </tr>
      </table>
    </div>

    <div class="mt-5" id="AnswerActivity">

      <h4>Programmazione attività</h4>

      <table class="w-100 mt-3 OutcomesTable">
        <tr class="mb-2">
      		<th>Risposta</th>
      		<th>Passa alla quest successiva</th>
          <th>Passa ad attività specifica</th>
          <th>Punteggio</th>
          <th>Rimuovi</th>
        </tr>
        <tr>
          <td><em>default</em></td>
          <td><input type="checkbox"></td>
          <td><input type="number" class="NextActivityInput" placeholder="0" size="6" min="0"></td>
          <td><input type="number" class="ScoreInput" placeholder="0" size="6"></td>
          <td></td>
        </tr>
      </table>
      
      <div id="AddOutcomeWidget" class="mb-3 mt-5">
        <p>Aggiungi outcome:</p>
        <br><button class="btn btn-primary mt-2" onclick="addOutcome();">Aggiungi</button>
      </div>
    </div>

    <div class="p-3 Save-Cancel">
      <button class="btn btn-success mb-3 mr-2 ml-2 rounded" onclick="saveOutcomes();">Salva</button>
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick="back();">Annulla</button>
    </div>
  </main>


  <!-- SCHERMATA DI MODIFICA TESTO -->
  <main class="inner cover EditorSection" id="EditText">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Paragrafo di testo</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Aggiungi un nuovo paragrafo al testo dell'attività.
    </p>

    <textarea id="TextParInput" rows="15" cols="50" placeholder="Inserisci un testo..."></textarea>

    <div class="p-3 Save-Cancel">
      <button class="btn btn-success mb-3 mr-2 ml-2 rounded" onclick="saveTextParagraph();">Salva</button>
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick="back();">Annulla</button>
    </div>
  </main>


  <!-- SCHERMATA DI MODIFICA GALLERY -->
  <main class="inner cover EditorSection" id="EditGallery">
    <header>
      <small></small>
      <h1 class="cover-heading SectionTitle">Galleria di immagini</h1>
    </header>
    <p class="lead mb-5 SectionHeader">
      Aggiungi una sezione contenente una o più immagini.
    </p>

    <div class="col-xs-12 alert alert-warning text-justify" role="alert">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Formati accettati: JPG, PNG.<br>Files di tipo differente non saranno caricati.</p>
    </div>

    <div class="container" id="GalleryPreview"></div>

    <div class="p-3 Save-Cancel">
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick="$('#UploadImg').trigger('click');" data-toggle="tooltip" data-placement="left" title="Aggiungi immagini">
        <i class="fas fa-plus"></i>
      </button>
      <input type="file" id="UploadImg" style="display:none;" multiple>
      <button class="btn btn-success mb-3 mr-2 ml-2 rounded" onclick="saveImageGallery();">Salva</button>
      <button class="btn btn-secondary mb-3 mr-2 ml-2 rounded" onclick="back();">Annulla</button>
    </div>

    <script>
      const fileSelector = document.getElementById("UploadImg");
      fileSelector.addEventListener("change", function(event) {
        for ( pic of event.target.files ) {
          switch ( getFileExtension(pic.name) ) {
            case "jpg":
            case "JPG":
            case "jpeg":
            case "JPEG":
            case "png":
            case "PNG":
              if (pic) {
                MediaBuffer.push({
                  server: false,
                  src: pic,
                  alt: ""
                });

                addImage(MediaBuffer[MediaBuffer.length - 1]);
              };
          }
        }
      });
    </script>
  </main>


  <!-- HELP BUTTON -->
  <button id="HelpBtn" class="btn btn-lg btn-primary rounded" onclick="showHelp();"><i class="fas fa-question"></i></button>


  <main role="main" class="inner cover EditorSection" id="ChooseStoryToEdit">
    <button class="btn btn-lg btn-secondary mb-3 rounded CancelBtn" onclick="cancel_mode()" data-toggle="tooltip" data-placement="right" title="Cancel mode">
      <i class="fas fa-trash"></i>
    </button>
    <a class="nav-link" href="javascript:go_home('ChooseStoryToEdit')" data-toggle="tooltip" data-placement="bottom" title="Torna alla home">
      <i class="fas fa-home fa-2x"></i>
    </a>
   <p>Quelle che vedi qui sotto sono tutte le storie salvate sul server ma non 
     pubblicate(se vuoi modificare una storia pubblicata, devi prima ritirarla). 
     Clicca sulla storia che vuoi editare.
   </p>
    <div class="CardGrid container" id="StoriesGrid" >
    </div>
  </main>
  <main role="main" class="inner cover EditorSection " id="Explorer">
    <a class="nav-link" href="javascript:go_home('Explorer')" data-toggle="tooltip" data-placement="bottom" title="Torna alla home">
      <i class="fas fa-home fa-2x"></i>
    </a>
     <!-- <p style="border: solid 1px; " ondrop="drop(event)" ondragover="allowDrop(event)">
        <img src="loli.png" draggable='true' ondragstart="drag(event)" id="drag1" width="20%" height="30%">
      </p>
      <p style="border: solid 1px; " ondrop="drop(event)" ondragover="allowDrop(event)">
        <img src="loli.png" draggable='true' ondragstart="drag(event)" id="drag2" width="20%" height="30%">
      </p>  -->
      <style>
        .grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    
    grid-gap: 20px;
}
.grido {
  display: grid;
  grid-template-rows: 1fr 1fr;
}
      </style> 
  <div class="grido">
    <div class="card "  style="opacity: 0; cursor: default;" >
      <div class="card-body text-center">
        <p class="card-text">1</p>
      </div>
    </div>
  <div class=" container border border-white rounded mb-3 "   ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="this.classList.remove('border-primary');this.classList.add('border-white');">
    <div class="card-deck mb-2">          
    </div> 
  </div>
  </div>
  <div class="grid-container mb-5">
    <div id="publishableContainer" class="container border border-white rounded"  ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="this.classList.remove('border-primary');this.classList.add('border-white');">   
    </div>             
    <div id="publishedContainer" class="container border border-white rounded" ondragover="allowDrop(event)" ondrop="drop(event)" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="this.classList.remove('border-primary');this.classList.add('border-white');">          
    </div>
  </div>
  <div class='grido mt-5'>
  <textarea  rows="4" cols="50"style="color: red; background-color: transparent;" readonly>
This is a feedback area, if something went wrong with the server you will (probably) see an error message here. 
    </textarea>
  </div>
  </main>
  <!--
  <div class="EditorSection" id="TestSection">
    SEZIONE USATA PER DEBUGGING
  </div>
  -->
  
  
  <footer class="mastfoot mt-auto">
    <div class="inner small">
      <p> a cura di <a href="../about/team.html" target="_blank">studenti</a> dell'<a href="https://www.unibo.it/it">Alma Mater Studiorum</a>, 2020 </p>
    </div>
  </footer>

</div>
</body>

</html>
<!--
third button concept:
  there are three sections which represent a trash can, a 
  published stories container and an unpublished and consistent stories
  container. Every story, which is nothing but a card with the story's
  title within, can be dragged to any section any time, then there's a
  button to "stage/commit and push" the changes. when the saving is occuring
  there's a loading gif, then a return message is shown together with another
  gif(ofc) with a satisfied loli or a sad/angry one, representing success and 
  failure respectively. In the latter case all the errors are shown and associated 
  with the respective story in a feedback section at the bottom of the page, which
  is cleared everytime a saving is requested. Finally the three main sections are
  re-created to show the current stories' situation.
-->
